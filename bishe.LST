C51 COMPILER V7.01  BISHE                                                                  06/07/2006 19:12:52 PAGE 1   


C51 COMPILER V7.01, COMPILATION OF MODULE BISHE
OBJECT MODULE PLACED IN bishe.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE bishe.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1           /****************************************************
   2           波形发生器
   3           ****************************************************/
   4          #include <AT89X51.H>
   5          #include "lcd.h"
   6          
   7          /***********************************************************
   8          宏定义参数
   9          **********************************************************/
  10          #define ZHENGXUAN   1
  11          #define JUCHI            2
  12          #define FANG         3
  13          
  14          /*******************************************************************************
  15          全局变量定义和数组定义
  16          *******************************************************************************/
  17          uchar code sin[]={ 0x7F,0x87,0x8F,0x97,0x9F,0xA6,0xAE,0xB5,0xBC,0xC3,0xCA,0xD0,0xD6,0xDC,0xE1,0xE6
  18                            ,0xEB,0xEF,0xF2,0xF6,0xF8,0xFA,0xFC,0xFD,0xFE,0xFE,0xFE,0xFD,0xFC,0xFA,0xF8,0xF6
  19                            ,0xF2,0xEF,0xEB,0xE6,0xE1,0xDC,0xD6,0xD0,0xCA,0xC3,0xBC,0xB5,0xAE,0xA6,0x9F,0x97
  20                            ,0x8F,0x87,0x7F,0x77,0x6F,0x67,0x5F,0x58,0x50,0x49,0x42,0x3B,0x34,0x2E,0x28,0x22
  21                            ,0x1D,0x18,0x13,0x0F,0x0C,0x08,0x06,0x04,0x02,0x01,0x00,0x00,0x00,0x01,0x02,0x04
  22                            ,0x06,0x08,0x0C,0x0F,0x13,0x18,0x1D,0x22,0x28,0x2E,0x34,0x3B,0x42,0x49,0x50,0x58
  23                            ,0x5F,0x67,0x6F,0x77};
  24          uchar code shn[]={ 0x05,0x0a,0x0f,0x14,0x19,0x1e,0x23,0x28,0x2d,0x32,0x37,0x3c,0x41,0x46,0x4b,0x50,
  25                             0x55,0x5a,0x5f,0x64,0x69,0x6e,0x73,0x78,0x7d,0x82,0x87,0x8c,0x91,0x96,0x9b,0xa0,
  26                                             0xa5,0xaa,0xaf,0xb4,0xb9,0xbe,0xc3,0xc8,0xcd,0xd2,0xd7,0xdc,0xe1,0xe6,0xeb,0xf0,
  27                                             0xf5,0xfa,0xfa,0xf5,0xf0,0xeb,0xe6,0xe1,0xdc,0xd7,0xd2,0xcd,0xc8,0xc3,0xbe,0xb9,
  28                                             0xb4,0xaf,0xaa,0xa5,0xa0,0x9b,0x96,0x91,0x8c,0x87,0x82,0x7d,0x78,0x73,0x6e,0x69,
  29                                             0x64,0x5f,0x5a,0x55,0x50,0x4b,0x46,0x41,0x3c,0x37,0x32,0x2d,0x28,0x23,0x1e,0x19,
  30                                             0x14,0x0f,0x0a,0x05};
  31          uchar code fan[]={0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  32                            0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  33                                            0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  34                                            0x00,0x00,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
  35                                            0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
  36                                            0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
  37                                            0xff,0xff,0xff,0xff};
  38          //ucahr code table1[]={"please choose wave"};
  39          uchar code table1[]={"frequ:"};//频率
  40          uchar code table2[]={"ampli:"};//振幅
  41          uchar code table3[]={"wave:"};//波形
  42          uchar code table4[]={"Hz"};
  43          uchar code table5[]={"0123456789"};
  44          uchar code table6[]={"zx"};//正弦波
  45          uchar code table7[]={"sa"};//锯齿波
  46          uchar code table8[]={"fb"};     //方波
  47          
  48          
  49          //uchar code table9[]={"and press enter"};
  50          uchar table10[5];
  51          uchar state=1;
  52          uint  n=0;
  53          uchar count=1;
  54          uint th0;
  55          uint tl0;
C51 COMPILER V7.01  BISHE                                                                  06/07/2006 19:12:52 PAGE 2   

  56          uint frequency;
  57          uint amplitude;
  58          bit FLAG=0;
  59          /*********************************************************************************
  60          管脚定义
  61          *********************************************************************************/
  62          
  63          
  64          
  65          
  66          /////////////////////////////////////////////////////////////////////////////////
  67          //波形发送：方波部分
  68          ////////////////////////////////////////////////////////////////////////////////
  69          
  70          void timer0(void) interrupt 1 using 2
  71          {TL0=tl0;
  72   1       TH0=th0;
  73   1       //TH0=(65535-5)/256;
  74   1       //TL0=(65535-5)%256;
  75   1       //scan=1;
  76   1       //counter++;
  77   1       //if(counter==20)
  78   1        //{counter=0;
  79   1        //enabledis=1;
  80   1        //}
  81   1        FLAG=1;
  82   1      }
  83          
  84          void init(void)
  85          {TMOD=0x01;   //16位定时器
  86   1       EA=1;
  87   1       ET0=1;
  88   1       frequency=5;
  89   1       //th0=(65535-25)/256;
  90   1       //tl0=(65535-25)%256;
  91   1       th0=(65535-20000/frequency)>>8;
  92   1       tl0=(65535-20000/frequency)%256;
  93   1       TH0=th0;
  94   1       TL0=tl0;
  95   1       //SCON=0X00;
  96   1                      }
  97          
  98          
  99          
 100          
 101          
 102          /*///////////////////////////////////////////////////////////////////////
 103           函数名： ACSII转换函数
 104           功能：    
 105           返回值： 无
 106           注意：   无
 107          
 108          //////////////////////////////////////////////////////////////////////*/
 109          asc_change(int f) 
 110           {
 111   1       table10[3]=0x00;
 112   1       table10[2]=f%10+0x30;
 113   1       table10[1]=f/10%10+0x30;
 114   1       table10[0]=f/100+0x30;
 115   1       
 116   1       }
 117          
C51 COMPILER V7.01  BISHE                                                                  06/07/2006 19:12:52 PAGE 3   

 118          
 119          /*///////////////////////////////////////////////////////////////////////
 120           函数名： 数字选择函数
 121           功能：    
 122           返回值： 无
 123           注意：   count对应的是频率设置还是幅度设置
 124          
 125          //////////////////////////////////////////////////////////////////////*/
 126          select(uchar x)
 127          {while((P1&0xf0)!=0xf0);
 128   1       n=n*10+x;
 129   1       asc_change( n);
 130   1       
 131   1       if(count=1)
*** WARNING C276 IN LINE 131 OF BISHE.C: constant in condition expression
 132   1       {
 133   2        frequency=0.41048421+n*0.98452722+(n*n)*(0.00031684079);
 134   2        
 135   2       lcd_dis(table10,0x86);}
 136   1       
 137   1       else if(count=2)
*** WARNING C276 IN LINE 137 OF BISHE.C: constant in condition expression
 138   1       {amplitude=n;
 139   2       lcd_dis(table10,0xc5);}
 140   1       }
 141          /*///////////////////////////////////////////////////////////////////////
 142           函数名： 波形选择显示
 143           功能：    
 144           返回值： 无
 145           注意：   state是指当前对应的是什么波形
 146          
 147          //////////////////////////////////////////////////////////////////////*/
 148           wave(uchar t)
 149           {while((P1&0xf0)!=0xf0);
 150   1       if(t==1)
 151   1       lcd_dis(table6,0xce); //方波
 152   1       else if(t==2)
 153   1       lcd_dis(table7,0xce); //锯齿波
 154   1       else if(t==3)
 155   1       lcd_dis(table8,0xce); //正弦波
 156   1       state=t;//状态为t
 157   1       }
 158           /*///////////////////////////////////////////////////////////////////////
 159           函数名： 确定函数
 160           功能：    
 161           返回值： 无
 162           注意：   无
 163          
 164          //////////////////////////////////////////////////////////////////////*/
 165          enter()
 166          {
 167   1       while((P1&0xf0)!=0xf0);
 168   1      if(count==1)
 169   1      {//frequency=100;
 170   2       th0=(65535-20000/frequency)>>8;
 171   2       tl0=(65535-20000/frequency)%256;
 172   2       TH0=th0;
 173   2       TL0=tl0;
 174   2       TR0=1;
 175   2       n=0;}
 176   1      else if(count==2)
 177   1      {}
C51 COMPILER V7.01  BISHE                                                                  06/07/2006 19:12:52 PAGE 4   

 178   1      }
 179          /*///////////////////////////////////////////////////////////////////////
 180           函数名： 键盘扫描函数
 181           功能：    
 182           返回值： 无
 183           注意：   返回具体键位地址
 184          
 185          //////////////////////////////////////////////////////////////////////*/
 186          uchar key(void)    //键盘扫描
 187          {uchar sccode,recode;
 188   1       //P1=0xf0;
 189   1      if((P1&0xf0)!=0xf0)
 190   1      {delay(10);
 191   2      if((P1&0xf0)!=0xf0)
 192   2      {delay(10);
 193   3      if((P1&0xf0)==0xf0);
 194   3      sccode=0xfe;
 195   3      while((sccode&0x10)!=0)
 196   3      {P1=sccode;
 197   4      if((P1&0xf0)!=0xf0)
 198   4      {recode=(P1&0xf0)|0x0f;
 199   5      P1=0xf0;
 200   5      return((~sccode)+(~recode));
 201   5          }
 202   4       else
 203   4       sccode=(sccode<<1)|0x01;
 204   4       }
 205   3           }
 206   2              }
 207   1      P1=0xf0;
 208   1              return(0);
 209   1              }
 210          /*///////////////////////////////////////////////////////////////////////
 211           函数名： 键位对应函数
 212           功能：    
 213           返回值： 无
 214           注意：   无
 215          
 216          //////////////////////////////////////////////////////////////////////*/
 217          sweep()
 218          {uchar i;
 219   1      i=key();
 220   1      
 221   1      {
 222   2      switch(i)
 223   2      {
 224   3      case 0x11:TR0=0;select(1);break; 
 225   3      case 0x21:TR0=0;select(2);break;
 226   3      case 0x41:TR0=0;select(3);break;
 227   3      case 0x81:TR0=0;wave(1);  break; //方波
 228   3      case 0x12:TR0=0;select(4);break;
 229   3      case 0x22:TR0=0;select(5);break;
 230   3      case 0x42:TR0=0;select(6);break;
 231   3      case 0x82:TR0=0;wave(2);  break; //正弦波
 232   3      case 0x14:TR0=0;select(7);break;
 233   3      case 0x24:TR0=0;select(8);break;
 234   3      case 0x44:TR0=0;select(9);break;
 235   3      case 0x84:TR0=0;wave(3);  break;
 236   3      case 0x18:TR0=0;enter();  break; //确定
 237   3      case 0x28:TR0=0;select(0);break;
 238   3      case 0x48:TR0=0;count=2;  break;
 239   3      //case 0x88:TR0=0;wave(3); break;
C51 COMPILER V7.01  BISHE                                                                  06/07/2006 19:12:52 PAGE 5   

 240   3      }                                                                               
 241   2        
 242   2          }}
 243          
 244          /*///////////////////////////////////////////////////////////////////////
 245           函数名： 主函数
 246           功能：    
 247           返回值： 无
 248           注意：   无
 249          
 250          //////////////////////////////////////////////////////////////////////*/
 251           main()
 252          {
 253   1      
 254   1       uchar k,out;
 255   1       init();
 256   1          lcdinit();
 257   1          delay(3);
 258   1         lcd_dis(table1,0x80);//频率
 259   1         lcd_dis(table2,0xc0);//振幅
 260   1         lcd_dis(table3,0xc9);  //波形
 261   1        
 262   1         wave(1); //默认是正弦波
 263   1          P2=0X00;
 264   1              TR0=1;
 265   1              P1=0XF0;
 266   1        while(1)
 267   1       {
 268   2       
 269   2         
 270   2          if(state==1)//正弦波
 271   2             {for(k=0;k<100;)
 272   3               {
 273   4                       if(P1!=0xf0)
 274   4                       { sweep();}
 275   4                    if(FLAG==1)
 276   4               {out=sin[k];
 277   5                   FLAG=0;
 278   5                               //P2_4=0;
 279   5                               //delay(255);
 280   5                   P0=out;
 281   5                    k++; }
 282   4                           }      }
 283   2      
 284   2       
 285   2       
 286   2          else if(state==2) //三角波
 287   2          {for(k=0;k<100;)
 288   3               {
 289   4                       if(P1!=0xf0)
 290   4                       { sweep();}
 291   4                    if(FLAG==1)
 292   4               {out=shn[k];
 293   5                   FLAG=0;
 294   5                               //P2_4=0;
 295   5                               //delay(255);
 296   5                   P0=out;
 297   5                    k++; }
 298   4                           }   }  
 299   2              else if(state==3) //方波
 300   2          {for(k=0;k<100;)
 301   3               {
C51 COMPILER V7.01  BISHE                                                                  06/07/2006 19:12:52 PAGE 6   

 302   4                       if(P1!=0xf0)
 303   4                       { sweep();}
 304   4                   
 305   4                       if(FLAG==1)
 306   4               {out=fan[k];
 307   5                   FLAG=0;
 308   5                               //P2_4=0;
 309   5                               //delay(255);
 310   5                   P0=out;
 311   5                    k++; }
 312   4                           }   }   
 313   2                                               
 314   2                                               
 315   2                                               }         }
 316           
 317           
 318           
 319           


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    876    ----
   CONSTANT SIZE    =    343    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     17       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
